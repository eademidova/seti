---
## Front matter
title: "Лабораторная работа №6"
subtitle: "Адресация IPv4 и IPv6. Двойной стек"
author: "Демидова Екатерина Алексеевна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
# bibliography: bib/cite.bib
# csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: false # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Изучение принципов распределения и настройки адресного пространства на устройствах сети.

# Задание

1. Разбиение сети на подсети
 - Разбиение IPv4-сети на подсети
 - Разбиение IPv6-сети на подсети
2. Настройка двойного стека адресации IPv4 и IPv6 в локальной сет
3. Выполнить задание для самостоятельной работы

# Выполнение лабораторной работы

## Разбиение сети на подсети

### Разбиение IPv4-сети на подсети

Задание:

1. Задана IPv4-сеть 172.16.20.0/24. Для заданной сети определите префикс, маску, broadcast-адрес, число возможных подсетей, диапазон адресов узлов. Разбейте сеть на 3 подсети с максимально возможным числом адресов узлов 126, 62, 62 соответственно.
2. Задана сеть 10.10.1.64/26. Для заданной сети определите префикс, маску, broadcast-адрес, число возможных подсетей, диапазон адресов узлов. Выделим в этой сети подсеть на 30 узлов. Запишите характеристики для выделенной подсети.
3. Задана сеть 10.10.1.0/26. Для этой сети определите префикс, маску, broadcast- адрес, число возможных подсетей, диапазон адресов узлов. Выделите в этой сети подсеть на 14 узлов. Запишите характеристики для выделенной подсети

1. Префикс IPv4-сети 172.16.20.0/24 - длины 24, то есть 176.16.20. Маска - 255.255.255.0, broadcast-адрес - 172.16.20.255, число возможных подсетей $2^8 = 256$. Разобьем эту сеть на три подсети. Сначала выделим подсеть с наибольшим количеством хостов - 126(+2 для идентификатора подсети и широкофещательного адреса), для этого нам нужно 128 адресов, то есть маска подсети будет 255.255.255.128. Первый IP в этой подсети будет 172.16.20.1/25, последний - 172.16.20.126/25. Номер подсети равен 172.16.20.0/25. Затем выделим две подсети с количеством хостов - 62. В первой их них: маска подсети будет 255.255.255.192, первый IP в этой подсети будет 172.16.20.129/26, последний - 172.16.20.191/26. Номер подсети равен 172.16.20.128/26. Во второй: маска подсети будет 255.255.255.192, первый IP в этой подсети будет 172.16.20.193/26, последний - 172.16.20.254/26. Номер подсети равен 172.16.20.192/26.

2. Префикс IPv4-сети 10.10.1.64/26 - длины 26, то есть 10.10.1.64 Маска - 255.255.255.192, broadcast-адрес - 10.10.1.127/26, число возможных подсетей $2^6 = 64$. Выделим в этой сети подсеть на 30 узлов. Нам необходимо хостов - 30(+2 для идентификатора подсети и широкофещательного адреса), для этого нам нужно 32 адреса, то есть маска подсети будет 255.255.255.224. Первый IP в этой подсети будет 10.10.1.65/27, последний - 10.10.1.94/27. Номер подсети равен 10.10.1.64/27. широкофещательный адрес - 10.10.1.95.

3. Префикс IPv4-сети 10.10.1.0/26 - длины 26, то есть 10.10.1. Маска - 255.255.255.192, broadcast-адрес - 10.10.1.127/26, число возможных подсетей $2^6 = 64$. Выделим в этой сети подсеть на 30 узлов. Нам необходимо хостов - 14(+2 для идентификатора подсети и широкофещательного адреса), для этого нам нужно 16 адреса, то есть маска подсети будет 255.255.255.240. Первый IP в этой подсети будет 10.10.1.1/28, последний - 10.10.1.44/28. Номер подсети равен 10.10.1.0/28. широкофещательный адрес - 10.10.1.15.

### Разбиение IPv6-сети на подсети

Задание:

1. Задана сеть 2001:db8:c0de::/48. Охарактеризуйте адрес, определите маску, префикс, диапазон адресов для узлов сети (краевые значения). Разбейте сеть на 2 подсети с использованием идентификатора подсети.
2. Задана сеть 2a02:6b8::/64. Охарактеризуйте адрес, определите маску, префикс, диапазон адресов для узлов сети (краевые значения). Разбейте сеть на 2 подсети с использованием идентификатора интерфейса. Поясните предложенные вами варианты разбиения.

1. Маска сети 2001:db8:c0de::/48 - ffff:ffff:ffff:0:0:0:0:0. Префикс имеет длину 48 и равен 2001:db8:c0de. Диапазон для узлов сети от 2001:0db8:c0de:0000:0000:0000:0000:0000 до 2001:0db8:c0de:ffff:ffff:ffff:ffff:ffff.
Рассчитаем шестнадцатеричное число (идентификатор подсети), следующее за префик-
сом глобальной маршрутизации(48 бит). Последние 64 бита идентифицируют
конкретный узел сети. Для сети 2001:db8:c0de::/48 можно выделить следующие подсети:

2001:db8:c0de:0002::/64

2001:db8:c0de:0003::/64

...

2001:db8:c0de:ffff::/64

Из этих подсетей мы можем взять любые две, например, подсеть с адресом 2001:db8:c0de:0002::/64 и с адресом 2001:db8:c0de:0003::/64.

2. Маска сети 2a02:6b8::/64 - ffff:ffff:ffff:ffff:0:0:0:0. Префикс имеет длину 64 и равен 2a02:6b8:0:0. Диапазон для узлов сети от 	2001:0db8:0000:0000:0000:0000:0000:0000 до  	2001:0db8:0000:0000:ffff:ffff:ffff:ffff.
Создадим подсеть на границе полубайта (4 бита или одна шестнадцатеричная цифра).Тогда префикс подсети /64 расширяется на четыре бита (или один полубайт) до подсети /68, что позволяет уменьшить размер идентификатора интерфейса на 4 бита (с 64 до 60). Для сети 2001:db8:c0de::/64 можно выделить следующие подсети:

2001:db8:0000:0000:0000::/68

2001:db8:0000:0000:1000::/68

2001:db8:0000:0000:2000::/68

...

2001:db8:0000:ffff:e000::/68

2001:db8:0000:ffff:f000::/68

Из этих подсетей мы можем взять любые две, например, подсеть с адресом 2001:db8:0000:0000:0000::/68 и с адресом 2001:db8:0000:0000:1000::/68.

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

Запустим GNS3 VM и GNS3 и создадим новый проект.
В рабочем пространстве разместим и соединим устройства в соответствии с топологией, приведённой в лабораторной работе. Для подсети IPv4 используем маршрутизатор FRR, а для подсети с IPv6 — нужен маршрутизатор VyOS, но так как на моем устройстве VyOS и FRR при одновременной работе завершают с ошибкой работу GNS3 VM, я использую так же маршрутизатор FRR(рис. @fig:001). Изменим отображаемые названия устройств. Коммутаторам присвоим названия по принципу msk-eademidova-sw-0x, маршрутизаторам — по принципу msk-eademidova-gw-0x, VPCS — по принципу PCx-eademidova, где вместо x — порядковый номер устройства. Также включим захват трафика на соединении между сервером двойного стека адресации и ближайшим к нему коммутатором.

![Создание топологии сети, задание имен устройств и включение захвата трафика](image/1.png){#fig:001 width=70%}

Руководствуясь таблицей в лабораторной работе, настроим IPv4-адресацию для интерфейсов узлов PC1, PC2, Server(рис. @fig:002-@fig:004).

![Настройка IPv4-адресации для интерфейса узла PC1](image/2.png){#fig:002 width=70%}

![Настройка IPv4-адресации для интерфейса узла PC2](image/3.png){#fig:003 width=70%}

![Настройка IPv4-адресации для интерфейса узла Server](image/4.png){#fig:004 width=70%}

Руководствуясь таблицей в лабораторной работе, настроим IPv4-адресацию для интерфейсов локальной сети маршрутизатора FRR msk-eademidova-gw-01(рис. @fig:005):

![Настройка IPv4-адресации для интерфейсов локальной сети маршрутизатора FRR](image/5.png){#fig:005 width=70%}

Проверим конфигурацию маршрутизатора и настройки IPv4-адресаци(рис. @fig:006).

![Проверка конфигурации и настройки IPv4-адресации для маршрутизатора FRR](image/6.png){#fig:006 width=70%}

Проверим подключение с помощью команд ping и trace. Узлы PC1 и PC2 успешно отправляют эхо-запросы друг другу и на сервер с двойным стеком(рис. @fig:007).

![Проверка подключения с помощью команд ping и trace состороны PC1](image/7.png){#fig:007 width=70%}

![Проверка подключения с помощью команд ping и trace состороны PC2](image/8.png){#fig:008 width=70%}

Руководствуясь таблицей в лабораторной работе, настроим IPv6-адресацию для интерфейсов узлов PC4, PC3, Server(рис. @fig:009-@fig:011). 

![Настройка IPv6-адресации для интерфейса узла PC3](image/9.png){#fig:009 width=70%}

![Настройка IPv6-адресации для интерфейса узла PC4](image/10.png){#fig:010 width=70%}

![Настройка IPv6-адресации для интерфейса узла Server](image11.png){#fig:011 width=70%}

Руководствуясь таблицей данной в лабораторной работе настрою IPv6-адресацию для интерфейсов локальной сети маршрутизатора FRR msk-user-gw-02(рис. @fig:012).

![Настройка IPv6-адресации для интерфейсов локальной сети маршрутизатора FRR](image12.png){#fig:012 width=70%}

Проверим подключение с помощью команд ping и trace. Узлы PC3 и PC4 успешно отправляют эхо-запросы друг другу и на сервер с двойным стеком(рис. @fig:0013,@fig:015).

![Проверка подключения с помощью команд ping и trace состороны PC3](image/13.png){#fig:013 width=70%}

![Проверка подключения с помощью команд ping и trace состороны PC4](image/14.png){#fig:014 width=70%}

Убедимся с помощью команды ping, что устройства из подсети IPv4 не доступны для устройств из подсети IPv6 и наоборот и что олько сервер двойного стека может обращаться к устройствам обеих подсетей (рис. @fig:015-@fig:017). 

![Пингование из сети IPv4 сети IPv6](image/15.png){#fig:015 width=70%}

![Пингование из сети IPv6 сети IPv4](image/16.png){#fig:016 width=70%}

![Пингование из сервера двойного стека сетей IPv4 и IPv6](image/17.png){#fig:017 width=70%}

Посмотрим захваченный на соединении сервера двойного стека адресации
с коммутатором трафик ARP, ICMP, ICMPv6(рис. @fig:018). В начале формируются ARP пакеты сообщаюшие IP-адрес сервера. При пинговании в сети IPv4 для эхо-запросов и ответов формируются ICMP-пакеты, в сети IPv6 формируются ICMPv6 пакеты(рис. @fig:019), так как пингование идёт на адрес IPv6. Также в версии 6 периодически посылаются пакеты с широковещательного адреса. 

![Пингование в сети IPv4](image/18.png){#fig:018 width=70%}

![Пингование в сети IPv6](image/19.png){#fig:019 width=70%}

## Задание для самостоятельного выполнения

Предполагается, что маршрутизатор разбивает сеть на две подсети с адресами
IPv4 и IPv6:
- подсеть 1: 10.10.1.96/27; 2001:DB8:1:1::/64;
- подсеть 2: 10.10.1.16/28; 2001:DB8:1:4::/64.

Требуется:
1. Охарактеризовать подсети, указать, какие адреса в них входят.
2. Предложить вариант таблицы адресации для заданной топологии и адресного
пространства, причём для интерфейсов маршрутизатора выбрать наимень-
ший адрес в подсети.
3. Настроить IP-адресацию на маршрутизаторе VyOS и оконечных устройствах,
причём на интерфейсах маршрутизатора установить наименьший адрес
в подсети.
4. Проверить подключение между устройствами подсети с помощью команд
ping и trace.

1. В первой подсети в IPv4-адресе длина расширенного префикса 27, маска имеет значение 255.255.255.224, адрес подсети имеет значение 10.10.1.96, broadcast-адрес 10.10.1.127, число хостов вычисляется выражением $2^5$ минус два адреса(сети и broadcast) и равняется 30. Первый адрес -- 10.10.1.97, последний - 10.10.1.126.

В IPv6-адресе длина префикса 64, Первый хост - 2001:db8:1:1::1, последний - 2001:0db8:1:1:ffff:ffff:ffff:fffe. Число адресов -- $2^64 = 1.8446744e+19$

Во второй подсети в IPv4-адресе длина расширенного префикса 28, маска имеет значение 255.255.255.240, адрес подсети имеет значение 10.10.1.16, broadcast-адрес 10.10.1.31, число хостов вычисляется выражением $2^4$ минус два адреса(сети и broadcast) и равняется 16. Первый адрес -- 10.10.1.17, последний - 10.10.1.30.

В IPv6-адресе длина префикса 64, Первый хост - 2001:db8:1:4::1, последний - 2001:db8:1:4:ffff:ffff:ffff:fffe. Число адресов -- $2^64 = 1.8446744e+19$

2. Предложим таблицу адресации для топологии приведённой в лабораторной работе.




# Выводы

В результате выполнения лабораторной работы были изучены принципы распределения и настройки адресного пространства на устройствах сети.


